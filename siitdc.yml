name: siitdc
  
topology:
  nodes:

    # switch Nokia SRL
    srl1:
      kind: nokia_srlinux
      image: ghcr.io/nokia/srlinux:23.10.1
      type: ixrd3
      startup-config: srlsw/config.json 
    
    BR:
      kind: linux
      image: quay.io/frrouting/frr:8.4.1
      binds:
        - BR/daemons:/etc/frr/daemons
        - BR/frr.conf:/etc/frr/frr.conf
      exec:
       - "sysctl -w net.ipv6.conf.all.forwarding=1" 
       - ip -6 route del default dev eth0

    BR6:
      kind: linux
      image: quay.io/frrouting/frr:8.4.1
      binds:
        - BR6/daemons:/etc/frr/daemons
        - BR6/frr.conf:/etc/frr/frr.conf
      exec:
       - "sysctl -w net.ipv6.conf.all.forwarding=1" 
       - ip -6 route del default dev eth0 
    
    CLAT:
      kind: linux
      image: siit-dcv2.1:latest
      exec:
       - ip -6 route del default dev eth0
       - ip -6 addr add 2001:db8:10:6::1/64 dev eth1
       - ip addr add 10.0.0.1/255.255.255.0 dev eth1
       - ip -6 addr add 2001:db8::10/48 dev eth2
       - "sysctl -w net.ipv4.ip_forward=1"
       - "sysctl -w net.ipv6.conf.all.forwarding=1"

    PLAT:
      kind: linux
      image: siit-dcv2.1:latest
      exec:
       - ip -6 route del default dev eth0
       - ip -6 addr add 2001:db8:1::4/48 dev eth1
       - ip addr add 192.0.2.1/255.255.255.0 dev eth2
       - "sysctl -w net.ipv4.ip_forward=1"
       - "sysctl -w net.ipv6.conf.all.forwarding=1"
    
    S4:
      kind: linux
      image: esanchezv/ubuntu2204:latest
      exec:
      - ip -6 route del default dev eth0
      - ip addr add 192.0.2.80/24 dev eth1
      #- ip route add default dev eth1
    S6:
      kind: linux
      image: esanchezv/ubuntu2204:latest
      exec:
      - ip -6 route del default dev eth0
      - ip -6 addr add 2001:db8:6::80/48 dev eth1
      #- ip -6 route add default via 2001:db8:6::1
      
    C64:
      kind: linux
      image: docker.io/wbitt/network-multitool:extra
      exec:
      - ip -6 route del default dev eth0
      - ip route del default dev eth0
      - ip addr add 10.0.0.20/24 dev eth1
      - ip -6 addr add 2001:db8:10:6::20/64 dev eth1
      #- ip route add default via dev eth1
      #- ip -6 route add default via dev eth1
                
  links:
    - endpoints: ["C64:eth1", "CLAT:eth1"]
    - endpoints: ["CLAT:eth2", "BR:eth1"]
    - endpoints: ["BR:eth2", "srl1:e1-1"]    
    - endpoints: ["PLAT:eth1", "srl1:e1-2"]
    - endpoints: ["PLAT:eth2", "S4:eth1"]
    - endpoints: ["BR6:eth1", "srl1:e1-3"]
    - endpoints: ["BR6:eth2", "S6:eth1"] 
     
